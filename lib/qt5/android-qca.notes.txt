mkdir qca-build
tar xf qca-master-0768474.tar.gz -C qca-build/
cd qca-build/qca

export QT_ANDROID=~/Qt5.3.2/5.3/android_armv7

export NDK=~/Qt5.3.2/android/android-ndk-r10b
$NDK/build/tools/make-standalone-toolchain.sh --platform=android-14 --toolchain=arm-linux-androideabi-4.8 --install-dir=`pwd`/android-toolchain-arm

cp ${QT_ANDROID}/bin/* android-toolchain-arm/bin/
cp -r ${QT_ANDROID}/include/* android-toolchain-arm/include/

export OPENSSL_LIBRARIES=~/Qt5.3.2/android/openssl/openssl-1.0.1i
export OPENSSL_INCLUDE_DIR=~/Qt5.3.2/android/openssl/openssl-1.0.1i/include

sed -i 's/sys\/termios/termios/g' src/support/console.cpp
sed -i 's/IF (OPENSSL_FOUND)/#IF (OPENSSL_FOUND)/g' plugins/CMakeLists.txt
sed -i 's/ENDIF(OPENSSL_FOUND)/#ENDIF(OPENSSL_FOUND)/g' plugins/CMakeLists.txt
# We statically link the OpenSSL libs to the qca-ossl plugin as suggested here: http://wiki.openssl.org/index.php/Android
sed -i 's\${OPENSSL_LIBRARIES}\/home/rc/Qt5.3.2/android/openssl/openssl-1.0.1i/libssl.a /home/rc/Qt5.3.2/android/openssl/openssl-1.0.1i/libcrypto.a\g' plugins/qca-ossl/CMakeLists.txt

cmake -DCMAKE_TOOLCHAIN_FILE=../../android.toolchain.cmake -DANDROID_STANDALONE_TOOLCHAIN=./android-toolchain-arm -DANDROID_TOOLCHAIN_NAME=standalone -DBUILD_TESTS=OFF -DCMAKE_PREFIX_PATH=${QT_ANDROID}/lib/cmake -DOPENSSL_INCLUDE_DIR=~/Qt5.3.2/android/openssl/openssl-1.0.1i/include -G "Unix Makefiles"
# Remember to change the soname as well.
# Grep for "soname" and change the according entry.

make

# Important! Note that the plugin directory is "qca-qt5" and _not_ "crypto" although the log message says it differently.

